<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cyber Hack Challenge</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #1a1a2e, #16213e);
      color: white;
      text-align: center;
    }

    #splash {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    #splash img {
      max-width: 90%;
      width: 600px;
      border-radius: 20px;
      box-shadow: 0 0 20px #00ffcc;
      margin-bottom: 30px;
    }

    #splash button {
      padding: 14px 28px;
      font-size: 1.1rem;
      background-color: #00ffcc;
      color: black;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    #quiz-container {
      display: none;
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 20px;
      background-color: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 20px #00ffcc;
    }

    img.question {
      width: 400px;
      height: 250px;
      object-fit: contain;
      border-radius: 10px;
      margin: 20px auto;
    }

    h2 {
      font-size: 1.5rem;
    }

    #score, #timer {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 10px 0;
    }

    #answer-status {
      font-size: 1.3rem;
      min-height: 30px;
      color: #00ffcc;
    }

    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    .option {
      padding: 15px;
      background-color: #00ffcc;
      color: black;
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      cursor: pointer;
      text-align: left;
    }

    .option::before {
      content: attr(data-label) ". ";
      font-weight: bold;
    }

    #restart-btn {
      display: none;
    }
  </style>
</head>
<body>

<div id="splash">
  <img src="images/title.png" alt="Cyber Hack Challenge" />
  <button onclick="startQuiz()">üîä Start Quiz</button>
</div>

<div id="quiz-container">
  <img id="quiz-image" class="question" src="" alt="Cybersecurity Question" />
  <h2 id="question-text"></h2>
  <div id="score">Score: 0</div>
  <div id="timer">‚è≥ Time Left: 15s</div>
  <div class="options" id="options-container"></div>
  <div id="answer-status"></div>
  <button id="restart-btn" onclick="startQuiz()">üîÅ Play Again</button>
</div>

<audio id="winner-sound" src="https://www.soundjay.com/human/sounds/applause-01.mp3"></audio>

<script>
const fullQuestionBank = [
  { img: "images/sqli.jpg", correct: "SQL Injection", options: ["SQL Injection", "XSS", "Phishing", "DoS"], synonyms: ["sql injection", "sql", "database injection", "sequel injection", "sqli", "sequel"] },
  { img: "images/csrf.jpg", correct: "Cross Site Request Forgery", options: ["SQL Injection", "Cross Site Request Forgery", "IDOR", "Phishing"], synonyms: ["csrf", "cross site forgery", "cross", "cross site", "request", "forgery"] },
  { img: "images/xss.jpg", correct: "Cross Site Scripting", options: ["Broken Authentication", "Cross Site Scripting", "CSRF", "Phishing"], synonyms: ["xss", "cross site", "cross"] },
  { img: "images/idor.jpg", correct: "Insecure Direct Object Reference", options: ["DoS", "Insecure Direct Object Reference", "XSS", "CSRF"], synonyms: ["idor", "insecure object reference", "i door", "eye door"] },
  { img: "images/auth.jpg", correct: "Broken Authentication", options: ["DoS", "Broken Authentication", "Man in the Middle", "SQL Injection"], synonyms: ["broken authentication", "auth failure", "login flaw", "authentication failure"] },
  { img: "images/ssrf.jpg", correct: "Server Side Request Forgery", options: ["CSRF", "XSS", "Server Side Request Forgery", "Phishing"], synonyms: ["ssrf", "server side forgery", "server", "server side"] },
  { img: "images/phishing.jpg", correct: "Phishing", options: ["Phishing", "XSS", "SQL Injection", "Broken Access"], synonyms: ["email fraud", "spoofing", "fishing"] },
  { img: "images/data.jpg", correct: "Sensitive Data Exposure", options: ["Sensitive Data Exposure", "DoS", "Broken Auth", "Phishing"], synonyms: ["data exposure", "sensitive data leak", "data leak", "sensitive"] },
  { img: "images/iaaf.jpg", correct: "Identification and Authentication Failure", options: ["CSRF", "IDOR", "Identification and Authentication Failure", "XSS"], synonyms: ["authentication failure", "auth fail", "identification failure", "identification"] },
  { img: "images/insecure.jpg", correct: "Insecure Design", options: ["Phishing", "XSS", "Insecure Design", "Broken Auth"], synonyms: ["bad design", "weak architecture", "insecure", "design"] }
];

let questions = [], current = 0, score = 0, timer, timeLeft = 15;

const splash = document.getElementById("splash"),
      quizContainer = document.getElementById("quiz-container"),
      quizImage = document.getElementById("quiz-image"),
      questionText = document.getElementById("question-text"),
      answerStatus = document.getElementById("answer-status"),
      scoreDisplay = document.getElementById("score"),
      timerDisplay = document.getElementById("timer"),
      restartBtn = document.getElementById("restart-btn"),
      optionsContainer = document.getElementById("options-container"),
      winnerSound = document.getElementById("winner-sound");

let recognition;
if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'en-US';
  recognition.continuous = true;
  recognition.interimResults = false;
  recognition.onresult = (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
    handleAnswer(transcript);
  };
}

function normalize(text) {
  return text.trim().toLowerCase();
}

function isCorrectAnswer(input, correct, synonyms) {
  const normInput = normalize(input);
  const allAcceptable = [normalize(correct), ...synonyms.map(s => normalize(s))];
  return allAcceptable.some(ans => normInput.includes(ans) || ans.includes(normInput));
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function startQuiz() {
  splash.style.display = "none";
  quizContainer.style.display = "block";
  current = 0;
  score = 0;
  scoreDisplay.textContent = "Score: 0";
  answerStatus.textContent = "";
  timerDisplay.style.display = "block";
  quizImage.style.display = "block";
  restartBtn.style.display = "none";
  questions = [...fullQuestionBank];
  shuffle(questions);
  questions = questions.slice(0, 5);
  speak("Let's begin the quiz!");
  if (recognition) recognition.start();
  showQuestion();
}

function showQuestion() {
  if (current >= questions.length) {
    quizImage.style.display = "block";
    optionsContainer.innerHTML = "";
    timerDisplay.style.display = "none";
    scoreDisplay.textContent = `Final Score: ${score}/${questions.length}`;
    answerStatus.textContent = "";
    restartBtn.style.display = "inline-block";

    if (score === questions.length) {
      quizImage.src = "images/champion.png";
      questionText.textContent = "üèÜ You are a Cyber Champion!";
      winnerSound.play();
      speak("Perfect score! You are a cybersecurity champion!");
    } else if (score === questions.length - 1) {
      quizImage.src = "images/good.png";
      questionText.textContent = "üëè Good Job! Almost perfect.";
      speak("Good job! You scored four out of five.");
    } else {
      quizImage.src = "images/try-again.png";
      questionText.textContent = "üîÅ Try Again! You can do better.";
      speak("Try again! You scored less than four.");
    }

    if (recognition) recognition.stop();
    return;
  }

  const q = questions[current];
  quizImage.src = q.img;
  questionText.textContent = "Identify the vulnerability shown.";
  answerStatus.textContent = "";

  optionsContainer.innerHTML = "";
  const labels = ["1", "2", "3", "4"];
  q.options.forEach((option, index) => {
    const btn = document.createElement("button");
    btn.textContent = option;
    btn.className = "option";
    btn.setAttribute("data-label", labels[index]);
    btn.onclick = () => handleAnswer(option.toLowerCase());
    optionsContainer.appendChild(btn);
  });

  timeLeft = 15;
  updateTimer();
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) {
      clearInterval(timer);
      answerStatus.textContent = "‚è±Ô∏è Time's up!";
      speak("Time's up!");
      current++;
      setTimeout(showQuestion, 2000);
    }
  }, 1000);
}

function handleAnswer(selected) {
  clearInterval(timer);
  const q = questions[current];
  if (isCorrectAnswer(selected, q.correct, q.synonyms)) {
    score++;
    scoreDisplay.textContent = `Score: ${score}`;
    answerStatus.textContent = "‚úÖ Correct!";
    speak("Correct!");
  } else {
    answerStatus.textContent = "‚ùå Wrong answer.";
    speak("Wrong answer.");
  }
  current++;
  setTimeout(showQuestion, 2000);
}

function updateTimer() {
  timerDisplay.textContent = `‚è≥ Time Left: ${timeLeft}s`;
}

function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.pitch = 1;
  utter.rate = 1;
  speechSynthesis.speak(utter);
}
</script>

</body>
</html>
